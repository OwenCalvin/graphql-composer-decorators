<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middlewares | graphql-composer-decorators</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/graphql-composer-decorators/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/graphql-composer-decorators/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/graphql-composer-decorators/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/graphql-composer-decorators/favicon/favicon-16x16.png">
    <link rel="manifest" href="/graphql-composer-decorators/favicon/site.webmanifest">
    <link rel="mask-icon" href="/graphql-composer-decorators/favicon/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/graphql-composer-decorators/favicon/favicon.ico">
    <meta name="description" content="Create your GraphQL API using decorators!">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="preload" href="/graphql-composer-decorators/assets/css/0.styles.9d8226e5.css" as="style"><link rel="preload" href="/graphql-composer-decorators/assets/js/app.7f49a5ad.js" as="script"><link rel="preload" href="/graphql-composer-decorators/assets/js/2.05d6aa5c.js" as="script"><link rel="preload" href="/graphql-composer-decorators/assets/js/33.68c207eb.js" as="script"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/10.c9334b6e.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/11.2ea1343b.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/12.ce81946e.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/13.be1eb90e.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/14.8488eca9.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/15.3ea89aa6.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/16.a742318c.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/17.b16233a2.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/18.02d6cd36.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/19.2511acd6.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/20.f20c2942.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/21.1f3de14e.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/22.a8334ad3.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/23.d446303a.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/24.2c6d3c11.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/25.e1bbcc49.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/26.d7c5285a.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/27.9d8abde3.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/28.b3886421.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/29.6c434e80.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/3.7852ead0.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/30.68cf02ce.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/31.642d4920.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/32.39b2d5e8.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/34.f7de42eb.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/35.c978f32b.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/36.49796678.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/37.321e49b4.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/38.f4afe9a8.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/39.afab462b.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/4.5c9f4258.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/40.3d335852.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/41.0d5426c8.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/42.1269e516.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/5.c43d97ba.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/6.927d4caf.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/7.f9c325a5.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/8.8540d400.js"><link rel="prefetch" href="/graphql-composer-decorators/assets/js/9.85f91414.js">
    <link rel="stylesheet" href="/graphql-composer-decorators/assets/css/0.styles.9d8226e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/graphql-composer-decorators/" class="home-link router-link-active"><img src="/graphql-composer-decorators/logo.png" alt="graphql-composer-decorators" class="logo"> <span class="site-name can-hide">graphql-composer-decorators</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/graphql-composer-decorators/queries/middlewares.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en
</a></li><li class="dropdown-item"><!----> <a href="/graphql-composer-decorators/fr/queries/middlewares.html" class="nav-link">
  fr
</a></li></ul></div></div> <a href="https://github.com/owencalvin/graphql-composer-decorators" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/graphql-composer-decorators/queries/middlewares.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en
</a></li><li class="dropdown-item"><!----> <a href="/graphql-composer-decorators/fr/queries/middlewares.html" class="nav-link">
  fr
</a></li></ul></div></div> <a href="https://github.com/owencalvin/graphql-composer-decorators" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/graphql-composer-decorators/intro/introduction" class="sidebar-heading clickable"><span>Introduction</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/graphql-composer-decorators/intro/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/graphql-composer-decorators/intro/installation.html" class="sidebar-link">Installation</a></li><li><a href="/graphql-composer-decorators/intro/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/graphql-composer-decorators/intro/typegraphql-comparison.html" class="sidebar-link">Differences with TypeGraphQL</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/graphql-composer-decorators/types/object-type" class="sidebar-heading clickable"><span>Types</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/graphql-composer-decorators/types/object-type.html" class="sidebar-link">ObjectType</a></li><li><a href="/graphql-composer-decorators/types/input-type.html" class="sidebar-link">InputType</a></li><li><a href="/graphql-composer-decorators/types/interface-type.html" class="sidebar-link">InterfaceType</a></li><li><a href="/graphql-composer-decorators/types/union-type.html" class="sidebar-link">Union type</a></li><li><a href="/graphql-composer-decorators/types/enum-type.html" class="sidebar-link">Enum type</a></li><li><a href="/graphql-composer-decorators/types/inheritance.html" class="sidebar-link">Inheritance</a></li><li><a href="/graphql-composer-decorators/types/generic-type.html" class="sidebar-link">Generic types</a></li><li><a href="/graphql-composer-decorators/types/field.html" class="sidebar-link">Field</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/graphql-composer-decorators/queries/resolver" class="sidebar-heading clickable open"><span>Queries</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/graphql-composer-decorators/queries/resolver.html" class="sidebar-link">Resolver</a></li><li><a href="/graphql-composer-decorators/queries/middlewares.html" aria-current="page" class="active sidebar-link">Middlewares</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/graphql-composer-decorators/queries/middlewares.html#building-and-using-function-based-middleware" class="sidebar-link">Building and using function-based middleware</a></li><li class="sidebar-sub-header"><a href="/graphql-composer-decorators/queries/middlewares.html#building-and-using-class-based-middleware" class="sidebar-link">Building and using class based middleware</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/graphql-composer-decorators/queries/description" class="sidebar-heading clickable"><span>Meta</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/graphql-composer-decorators/meta/description.html" class="sidebar-link">Description</a></li><li><a href="/graphql-composer-decorators/meta/extensions.html" class="sidebar-link">Extensions</a></li><li><a href="/graphql-composer-decorators/meta/deprecated.html" class="sidebar-link">Description</a></li><li><a href="/graphql-composer-decorators/meta/directives.html" class="sidebar-link">Extensions</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="middlewares"><a href="#middlewares" class="header-anchor">#</a> Middlewares</h1> <p>Middlewares are very common in backend development, they allow you to avoid repetition, to clarify your code and to better organize it.
The system used by this module is based on <a href="https://koajs.com/" target="_blank" rel="noopener noreferrer"><code>koa</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> middleware.</p> <h2 id="building-and-using-function-based-middleware"><a href="#building-and-using-function-based-middleware" class="header-anchor">#</a> Building and using function-based middleware</h2> <p>A middleware is a function that is executed before the main function of a request. For example, it can be used to verify that a user is authenticated.<br>
Here we will create a middleware that checks the value of an argument.</p> <h3 id="_1-declaration"><a href="#_1-declaration" class="header-anchor">#</a> 1. Declaration</h3> <p>Let's declare the function</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Context<span class="token punctuation">,</span> Next <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-compose&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">verifiyArgs</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> context<span class="token operator">:</span> Context<span class="token punctuation">,</span> next<span class="token operator">:</span> Next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-validation"><a href="#_2-validation" class="header-anchor">#</a> 2. Validation</h3> <p>If the condition is met, we will have to tell our middleware that it can go to the next middleware, this is done with the parameter <code>next</code> which is an asynchronous function to call.<br>
If <code>next</code> is not called, the next middleware is simply not executed.</p> <blockquote><p>If you don't put <code>await</code> before <code>next()</code>, the current middleware will not wait until the next middleware has finished executing to execute the rest of its code.</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Context<span class="token punctuation">,</span> Next <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-compose&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">verifiyArgs</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> context<span class="token operator">:</span> Context<span class="token punctuation">,</span> next<span class="token operator">:</span> Next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token punctuation">(</span><span class="token string">&quot;Count must be greater than 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-use"><a href="#_3-use" class="header-anchor">#</a> 3. Use</h3> <p>Your middleware can be applied with the <code>@Middlewares</code> decorator at:</p> <ul><li>A <strong>resolver</strong></li> <li>An <strong>ObjectType</strong></li> <li>An <strong>InterfaceType</strong></li> <li>A <strong>query</strong></li> <li>A <strong>mutation</strong></li> <li>A <strong>subscription</strong></li></ul> <h4 id="with-query-or-mutation-or-subscription"><a href="#with-query-or-mutation-or-subscription" class="header-anchor">#</a> With <code>@Query</code> or <code>@Mutation</code> or <code>@Subscription</code></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Resolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>verifyArgs<span class="token punctuation">)</span>
  <span class="token function">query</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>verifyArgs<span class="token punctuation">)</span>
  <span class="token function">mutation</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pubsub<span class="token punctuation">.</span><span class="token function">asyncIterator</span><span class="token punctuation">(</span><span class="token string">&quot;NOTIFICATION&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>verifyArgs<span class="token punctuation">)</span>
  <span class="token function">subscription</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="with-resolver-or-objecttype-interfacetype"><a href="#with-resolver-or-objecttype-interfacetype" class="header-anchor">#</a> With <code>@Resolver</code> (or <code>ObjectType</code> / <code>InterfaceType</code>)</h4> <p>This will apply the middleware to all methods of the resolver.
The middlewares applied to <code>@Resolver</code> will be executed before the middlewares on the methods of the class.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">Middlewares</span><span class="token punctuation">(</span>verifyArgs<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Resolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">query</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">mutation</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pubsub<span class="token punctuation">.</span><span class="token function">asyncIterator</span><span class="token punctuation">(</span><span class="token string">&quot;NOTIFICATION&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">subscription</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="building-and-using-class-based-middleware"><a href="#building-and-using-class-based-middleware" class="header-anchor">#</a> Building and using class based middleware</h2> <p>It may be &quot;cleaner&quot; to use a class to declare middleware rather than a function directly. For this you can use the <code>Middleware</code> class provided by <code>graphql-composer-decorators</code>.</p> <h3 id="_1-declaration-2"><a href="#_1-declaration-2" class="header-anchor">#</a> 1. Declaration</h3> <p>Let's declare the class</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Context<span class="token punctuation">,</span> Next <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-compose&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-composer-decorators&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ArgsVerificator</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> context<span class="token operator">:</span> Context<span class="token punctuation">,</span> next<span class="token operator">:</span> Next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-validation-2"><a href="#_2-validation-2" class="header-anchor">#</a> 2. Validation</h3> <p>If the condition is met, we will have to tell our middleware that it can go to the next middleware, this is done with the parameter <code>next</code> which is an asynchronous function to call.<br>
If <code>next</code> is not called, the next middleware is simply not executed.</p> <blockquote><p>If you don't put <code>await</code> before <code>next()</code>, the current middleware will not wait until the next middleware has finished executing to execute the rest of its code.</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Context<span class="token punctuation">,</span> Next <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-compose&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;graphql-composer-decorators&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ArgsVerificator</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> context<span class="token operator">:</span> Context<span class="token punctuation">,</span> next<span class="token operator">:</span> Next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token punctuation">(</span><span class="token string">&quot;Count must be greater than 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-use-2"><a href="#_3-use-2" class="header-anchor">#</a> 3. Use</h3> <p>They can be used in the same way as a middleware based on a function
Your middleware can be applied with the <code>@Middlewares</code> decorator at:</p> <ul><li>A <strong>resolver</strong></li> <li>An <strong>ObjectType</strong></li> <li>An <strong>InterfaceType</strong></li> <li>A <strong>query</strong></li> <li>A <strong>mutation</strong></li> <li>A <strong>subscription</strong></li></ul> <h4 id="with-query-or-mutation-or-subscription-2"><a href="#with-query-or-mutation-or-subscription-2" class="header-anchor">#</a> With <code>@Query</code> or <code>@Mutation</code> or <code>@Subscription</code></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Resolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>ArgsVerificator<span class="token punctuation">)</span>
  <span class="token function">query</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>ArgsVerificator<span class="token punctuation">)</span>
  <span class="token function">mutation</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pubsub<span class="token punctuation">.</span><span class="token function">asyncIterator</span><span class="token punctuation">(</span><span class="token string">&quot;NOTIFICATION&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  @<span class="token function">Middlewares</span><span class="token punctuation">(</span>ArgsVerificator<span class="token punctuation">)</span>
  <span class="token function">subscription</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="with-resolver-or-objecttype-interfacetype-2"><a href="#with-resolver-or-objecttype-interfacetype-2" class="header-anchor">#</a> With <code>@Resolver</code> (or <code>ObjectType</code> / <code>InterfaceType</code>)</h4> <p>This will apply the middleware to all methods of the resolver.
The middlewares applied to <code>@Resolver</code> will be executed before the middlewares on the methods of the class.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Resolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">Middlewares</span><span class="token punctuation">(</span>ArgsVerificator<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Resolver</span> <span class="token punctuation">{</span>
  @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">query</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">mutation</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pubsub<span class="token punctuation">.</span><span class="token function">asyncIterator</span><span class="token punctuation">(</span><span class="token string">&quot;NOTIFICATION&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">subscription</span><span class="token punctuation">(</span>@<span class="token function">Arg</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/owencalvin/graphql-composer-decorators/edit/master/docs/queries/middlewares.md" target="_blank" rel="noopener noreferrer">Edit this file on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/graphql-composer-decorators/queries/resolver.html" class="prev">
        Resolver
      </a></span> <span class="next"><a href="/graphql-composer-decorators/meta/description.html">
        Description
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/graphql-composer-decorators/assets/js/app.7f49a5ad.js" defer></script><script src="/graphql-composer-decorators/assets/js/2.05d6aa5c.js" defer></script><script src="/graphql-composer-decorators/assets/js/33.68c207eb.js" defer></script>
  </body>
</html>
